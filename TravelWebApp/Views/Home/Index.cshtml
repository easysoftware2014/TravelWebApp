@{
    ViewBag.Title = "Home";
    Layout = "~/Views/shared/_TravelLayout.cshtml";
}

<style>
    .property {
        display: inline-block;
        margin: 10px;
        border: 1px solid #eee;
        box-shadow: 0 2px 2px #ccc;
        width: 200px;
        padding: 20px;
    }
</style>

@*<div class="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3 text-center">
                <h3>We provide online booking</h3>
                <a href="#" class="btn booking-btn text-center" data-toggle="modal" data-target="#sign_in">Click for Booking !</a>
            </div>
        </div>
    </div>
</div>*@

<div class="modal fade" id="sign_in" tabindex="-1" role="dialog" aria-labelledby="sign-in" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Log In</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="username">Username</label>
                    <br />
                    <input type="email" class="form-control" id="username" required="required" />
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <br />
                    <input type="password" class="form-control" id="password" required="required" />
                </div>
                <div class="form-group">
                    <input type="button" class="btn btn-success" id="btnSubmit" value="Submit">
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn text-center" data-toggle="modal" data-target="#registration">Register</a>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="registration" tabindex="-1" role="dialog" aria-labelledby="register" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" style="font-size: large">Registration Form</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="name">Name</label>
                    <br />
                    <input type="text" class="form-control" id="name" required="required" />
                </div>
                <div class="form-group">
                    <label for="surname">Surname</label>
                    <br />
                    <input type="text" class="form-control" id="surname" required="required" />
                </div>
                <div class="form-group">
                    <label for="contactNumber">Contact Number</label>
                    <br />
                    <input type="text" class="form-control" id="contactNumber" required="required" />
                </div>
                <h4 style="font-weight:lighter">Login Details:</h4>
                <hr />
                <div class="form-group">
                    <label for="email">Email</label>
                    <br />
                    <input type="email" class="form-control" id="email" required="required" />
                </div>
                <div class="form-group">
                    <label for="reg_password">Password</label>
                    <br />
                    <input type="password" class="form-control" id="reg_password" required="required" />
                </div>

            </div>69
            <div class="modal-footer">
                <input type="submit" class="btn btn-default" id="btnRegister" value="Register">
            </div>
        </div>
    </div>
</div>
<!-- begin:booking -->
<div class="modal fade" id="booking" tabindex="-1" role="dialog" aria-labelledby="booking" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Online Booking Form</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4 col-md-offset-2 text-center">
                        <a href="#" class="btn btn-block booking-btn" data-toggle="modal" data-target="#sign_in">Login</a>
                        @*@Html.ActionLink("Login", "Login", new { }, new { @class = "btn btn-primary" })*@
                    </div>
                    <div class="col-md-6 text-center">
                        <a href="#" class="btn booking-btn text-center" data-toggle="modal" data-target="#register">Register</a>
                        @*@Html.ActionLink("Register", "Register", new { }, new { @class = "btn btn-success" })*@
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div id="signalR_message"></div>
                @*<input type="submit" class="btn confirm-btn" value="Confirm">*@
            </div>
        </div>
    </div>
</div>
<!-- end:booking -->
<table id="result_table" class="table table-hover display" style="display: none" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Name</th>
            <th>Review</th>
            <th>Currency</th>
            <th>Price</th>
            <th>Rooms</th>
            <th></th>
        </tr>
    </thead>
</table>
<div class="row">
    <div class="col-md-12">
        
    </div>
</div>

<div class="row">
    <div id="booking_results">
    </div>
</div>


@section scripts
{
    <script src="~/Scripts/SignalR.js">
    </script>
    
    <script type="text/javascript">

        $('.nav-item a').click(function() {
            $('.active').removeClass('nav-item active');
            console.log($(this));
            $(this).addClass("nav-item active");
        });

        function convertDate(date) {
            var dateCopy = date.split('/');
            var newDateString = dateCopy[2] + "-" + dateCopy[0] + "-" + dateCopy[1];

            return newDateString;
        }

        $("#booking_search").click(function () {

            var $this = $(this);
            $this.button('loading');
            setTimeout(function() {
                $this.button('reset');
            }, 8000);

            var checkOut = convertDate($('#check_out_date').val());
            var checkIn = convertDate($('#check_in_date').val());
            var place = $('#search_place').val();
            var priceLimit = $('#price_limit option:selected').text();

            $.ajax({
                type: "GET",
                url: "/bookingmanagement/GetPropertyList/",
                contentType: "application/json; charset=utf-8",
                data: {destination: place, arrivalDate: checkIn, departureDate: checkOut},
                dataType: "json",
                success: function(obj) {
                    $('#booking-hotel').modal('hide');
                    $('#result_table').attr('display:', "block;");
                    //console.log(obj.Properties);
                    var results = obj.Properties;
                    //console.log(results);
                    $("#result_table").DataTable({
                        "data": results,
                        "columns": [
                            {"data" : "HotelName"},
                            {"data" : "Review"},
                            {"data" : "CurrencyCode" },
                            {"data" : "MinimumPrice"},
                            {"data" : "AvailableRooms"},
                            {"data" : "Url"}
                            ]
                    });
                    //$.each(obj.Properties.Result,
                    //    function (index, value) {
                    //        console.log(index);

                    //        $('#booking_results').append(
                    //            `<div class="property">
                    //                 ${value.HotelName}
                    //                 ${value.Review}
                    //                 <div class="img">
                    //                    <img src="${value.PhotoUrl}" class="img-fluid"></img>                                       
                    //                </div>   
                    //                <p>${value.MinimumPrice}</p>                                     
                    //            </div>`
                    //        );
                    //    });
                }

            });
            
        });
        $("#search_plac").focus();
    </script>

    @*<script type="text/javascript">
            (function(d, sc, u) {
                var s = d.createElement(sc), p = d.getElementsByTagName(sc)[0];
                s.type = 'text/javascript';
                s.async = true;
                s.src = u + '?v=' + (+new Date());
                p.parentNode.insertBefore(s,p);
            })(document, 'script', '//aff.bstatic.com/static/affiliate_base/js/flexiproduct.js');
        </script>


        <script type="text/javascript">

            $("#btnSubmit").click(function () {
                var username = $("#username").val();
                var password = $("#password").val();

                var data = {
                    'username': username,
                    'password': password
                };

                $.ajax({
                    type: "POST",
                    url: "user/login",
                    data: data,
                    success: function (result) {

                        if (result.success === true) {

                            window.location.href = "/bookingmanagement/";
                        } else {
                            alert("Incorrect combination of email and password, please reenter");
                        }
                    },
                    dataType: "json"
                });
            });
            $("#btnRegister").click(function () {
                var name = $("#name").val();
                var surname = $("#surname").val();
                var contact = $("#contactNumber").val();
                var username = $("#email").val();
                var password = $("#reg_password").val();


                var data = {
                    'email': username,
                    'password': password,
                    'name': name,
                    'surname': surname,
                    'contact': contact
                };

                $.ajax({
                    type: "POST",
                    url: "user/register",
                    data: data,
                    success: function (result) {
                        if (result.success === true) {

                            window.location.href = "/bookingmanagement/";
                        } else {
                            alert("Incorrect combination of email and password, please reenter");
                        }
                    },
                    dataType: "json"
                });
            });

            $("#login").click(function() {
                $('#sign_in').modal('show');
            });

        </script>*@
}


